# 变量

变量这家伙不就是用于存储数据的吗？还有什么好说的呢？

## ★初认识

> ECMAScript 的变量是**松散类型的**，所谓松散类型就是可以**用来保存任何类型的数据**。换句话说，每个变量仅仅是一个**用于保存值的占位符**而已。定义变量时要使用 **var 操作符**（注意 var 是一个关键字），**后跟变量名**（即一个标识符）

**✎：**

```js
var xxx
```

`var`竟然叫做操作符啊！之前有对关键字下过定义哦！，**✎：**

> ECMA-262 描述了一组具有**特定用途**的关键字，这些关键字可用于**表示控制语句的开始或结束**，或者**用于执行特定操作**等……

之所以叫`var`这个关键字为操作符在于它用于执行特定的操作，如声明什么的，老实说，我之前叫它为声明符，用于告诉解释器接下来要处理的字符是个用作变量的标识符啊！

话说回来，操作符和运算符这二者有区别吗？

给我的第一眼就是后者就是用作计算的！而前者就像有「做了某事」的调调！

**➹：**[如果理解编程语言中「操作符」（operator）的概念？ - 知乎](https://www.zhihu.com/question/34670236)

## ★拿具体例子说话

**✎：**

```js
var xxx
```

1. 这行代码定义了一个名为`xxx`的变量

2. `xxx`变量可以用来保存任何值（像这样**未经过初始化**的变量，会保存一个特殊的值—— `undefined`）

   前面有提到「ECMAScript 的变量是**松散类型的**」

   什么叫未初始化？你都自己给值了难道还没有初始化吗？一定要开发者一开始给了值才叫**经过了初始化**吗？

好吧！那就来个直接初始化变量好了，反正，**✎：**

> ECMAScript 也支持直接初始化变量，即在定义变量的同时就可以设置变量的值

就像是这样，**✎：**

```js
var xxxxxx = 'hi!'
```

我之前有了解过，这行代码的读法叫，声明`xxxxxx`并定义为`'hi'`值！

在这儿，书上的说法是，**✎：**

> 变量 xxxxxx 中保存了一个字符串值 "hi"

敲黑板来了，**✎：**

> 像这样初始化变量并**不会把它标记为字符串类型**；**初始化的过程就是给变量赋一个值那么简单**。因此，**可以在修改变量值的同时修改值的类型**

就像是这样，**✎：**

```js
var message = "hi";
message = 100; //   有效，但不推荐
```

我的天，不推荐啊！话说**TypeScript**岂不是贼强势！

**➹：**[TypeScript - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/TypeScript)

在这个例子中，一开始变量message保存了一个字符串值，然后该值又被一个数字值 100 取代。就像是一开始是人工的，而未来则被机器人给取代了！当然这是推荐的啊！毕竟机器人干活有效率、精确度高得可怕，基本不会犯错！

最佳实践，**✎：**

> 不建议修改变量所保存值的类型，但这种操作在 ECMAScript 中完全有效

## ★ `var`与函数的那些事儿

> 用 **var 操作符定义的变量**将成为定义**该变量的作用域中**的**局部**变量。也就是说，如果在函数中使用 var 定义一个变量，那么这个变量在**函数退出后就会被销毁**

**✎：**

```js
function test(){
	var message = "hi"; // 局部变量
}
test();
alert(message); // 错误！
```

怎么说呢？如果没有用var定义，那就是全局变量咯！

还有就是为啥函数退出后，局部变量就会被销毁呢？其销毁机制又是怎样的呢？这一点跟闭包又有什么关系呢？

好吧，不在探究了！解释一下上面的demo吧！**✎：**

> 变量 message 是在函数中使用 var 定义的。当函数被调用时，就会创建该变量并为其赋值。而在此之后，这个变量又会立即被销毁，因此例子中的下一行代码就会导致错误。

不是说我死扣字眼啊！在这里说到var是用于定义一个变量的，那好，我会把 `var message = 'hi'`读作为，**✎：**

**声明并定义一个变量`message`，且赋予其初始值为`'hi'`。**

ps：我所理解的默认值和初始值不是一个意思，前者是客观的存在，而后者则是主观的存在！

话不多说，如果省略了操作符会怎样，**✎：**

```js
function test(){
	message = "hi"; //  全局变量
}
test();
alert(message); // "hi"
```

那就会创建一个全局变量了啊！这意味着，只要调用过一次 test() 函数，这个变量就有了定义，就可以在函数外部的任何地方被访问到。

ps：这个只是定义，并无声明！即没有var操作符！

## ★敲黑板

> 虽然省略 var 操作符可以定义全局变量，但这也**不是我们推荐的做法**。因为在**局部作用域**中定义的**全局变量**很**难维护**，而且如果有意地忽略了 var 操作符，也会由于相应变量不会马上就有定义而导致不必要的混乱。给**未经声明的变量**赋值在**严格模式**下会导致抛出 **ReferenceError** 错误。

## ★只写一个`var`

> 可以使用**一条语句定义多个变量**，只要像下面这样把每个变量（初始化或不初始化均可）用**逗号分隔**开即可

**✎：**

```js
var message = "hi",
	found = false,
	age = 29;
```

解释一波，**✎：**

> 这个例子**定义并初始化了 3 个变量**。同样由于 ECMAScript 是松散类型的，因而使用**不同类型初始化变量**的操作可以**放在一条语句中**来完成。虽然代码里的**换行和变量缩进不是必需**的，但这样做可以**提高可读性**。

我觉得还是加上「声明」二字比较好，这意味着这些变量是由`var`操作符定义的变量，所以这个例子做了什么呢？

声明定义并初始化了3个变量，如果有一个是默认值的话，那就其中一个默认了个值`undefined`！

注意，**✎：**

> 在严格模式下，不能定义名为 eval 或 arguments 的变量，否则会导致语法错误。

## ★小结

- 局部变量是如何被销毁的，这一点需要去了解的！

- 初始化和默认值，在我看来不是一个意思！

- 话说回来，var→☞variable，即「变量的」之意！默认给个前缀，声明的变量！

- 变量是变量，变量名是变量名。变量名（给人看，一般用标识符，也叫别名）→☞变量（存储地址）→☞值（各种类型的数据）

  总之我们可以根据这个变量名找到这个数据，就是这么简单！

## ★Q&A

### ①什么是全局变量？

> 在[程序设计](https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1)中，**全局变量**是在**所有**[作用域](https://zh.wikipedia.org/wiki/%E4%BD%9C%E7%94%A8%E5%9F%9F)都**可访问**的变量，与之对应的是[局部变量](https://zh.wikipedia.org/wiki/%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F)。

给个理由我，为啥要少用全局变量？

应该说是使用**不必要的**全局变量被认为是坏习惯，为什么这么说呢？**✎：**

> 由于全局变量的非局部性：全局变量可能被**从任何地方修改**（除非位于[保护内存](https://zh.wikipedia.org/w/index.php?title=%E4%BF%9D%E6%8A%A4%E5%86%85%E5%AD%98&action=edit&redlink=1)中），也可能**被任何地方所依赖**。于是全局变量便拥有了**建立相互依存关系的无限可能**，而**互相依存关系的建立会使得复杂度增加**，参见[远隔作用](https://zh.wikipedia.org/wiki/%E8%BF%9C%E9%9A%94%E4%BD%9C%E7%94%A8_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6))（Action at distance）。然而，在**少数情况下是适合使用全局变量**的。例如，可以通过全局变量的使用来**避免常用变量在一系列函数间的频繁传递**。

### ②局部变量的销毁？

**➹：**[JavaScript关于局部变量销毁？ - 知乎](https://www.zhihu.com/question/56258547)

**➹：**[如何销毁js的变量啊？ - CSDN博客](https://blog.csdn.net/bigsea622/article/details/50781492)

**➹：**[局部变量与全局变量[JavaScript之美]_慕课手记](https://www.imooc.com/article/6393)

**➹：**[C 语言局部变量，堆与栈的问题？ - 知乎](https://www.zhihu.com/question/60415017)

**➹：**[JavaScript 中 闭包 的详解 · Issue #8 · lin-xin/blog](https://github.com/lin-xin/blog/issues/8)

**➹：**[关于在JS里删除变量 销毁所占内存 的讨论 - 奧義之舞 - ITeye博客](http://gaojianqi6.iteye.com/blog/1002280)

**➹：**[Javascript 闭包，引用的变量是否被回收？ - 知乎](https://www.zhihu.com/question/40678847)

搜索关键字

局部变量 销毁机制 - Google 搜索

### ③为什么需要变量？

**➹：**[★变量 (程序设计) - 维基百科，自由的百科全书](https://zh.wikipedia.org/wiki/%E5%8F%98%E9%87%8F_(%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1))

> 在[程序设计](https://zh.wikipedia.org/wiki/%E7%A8%8B%E5%BA%8F%E8%A8%AD%E8%A8%88)中，**变量**（英语：Variable，scalar）是指一个包含部分已知或未知数值或信息（即一个[值](https://zh.wikipedia.org/wiki/%E5%80%BC_(%E9%9B%BB%E8%85%A6%E7%A7%91%E5%AD%B8))）之[存储地址](https://zh.wikipedia.org/wiki/%E8%A8%98%E6%86%B6%E9%AB%94%E4%BD%8D%E5%9D%80)，以及相对应之[符号名称](https://zh.wikipedia.org/wiki/%E7%AC%A6%E8%99%9F)（[识别字](https://zh.wikipedia.org/wiki/%E6%A8%99%E8%AD%98%E7%AC%A6)）。通常使用变量名称[引用](https://zh.wikipedia.org/wiki/%E5%8F%83%E7%85%A7)存储值；将名称和内容分开能让被使用的名称独立于所表示的精确消息之外。

这里说到变量是个存储地址，也就是说变量与变量名是两个意思咯！变量是内容，而变量名则是容器咯！

用标识符引用变量，**✎：**

我之前以为标识符就是变量啊！为啥还要引用变量呢？原来变量所指是内容啊！

> **用标识符引用变量能对变量进行访问**，从而读出变量的值，改变变量的值，或者改变变量的属性（如[访问权限](https://zh.wikipedia.org/w/index.php?title=%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90&action=edit&redlink=1)、状态锁定等）。
>
> 例如，一个变量用标识符`total_count`来引用，设定这个变量的值为1981。如果该变量同时也用标识符`x` 来引用，通过`x`将变量值改变为2010，那么读取`total_count`的值就是2010而不是1981。
>
> 如果某种编程语言**只允许同一个变量用一个标识符引用**，那么**讨论“该变量的名字”就是有意义的**，否则我们称之为“该变量的名字之一”。例如，在前面的那个例子当中，`total_count`是这个变量的名字之一，而`x`是这个变量的另外一个名字。

显然，讨论JavaScript里的变量的名字是没有意义的！因为这变量有很多个花名啊！

话说，没有变量会发生什么？

无法记录程序的运行状态？

**➹：**[编程语言为什么区分常量和变量？ - 知乎](https://www.zhihu.com/question/35782789)

**➹：**[程序语言中的类型系统怎么理解，它有哪些要素？如何由它演化出一门编程语言的？ - 知乎](https://www.zhihu.com/question/22416404)

### ④变量名储存在哪儿？

**➹：**[变量名储存在那里，变量的储存机制是什么？ - 知乎](https://www.zhihu.com/question/34266997)

[变量名储存在那里，变量的储存机制是什么？ - 钟宇腾的回答 - 知乎](https://www.zhihu.com/question/34266997/answer/58216260)

> 变量名不需要储存，变量名是给人看的，编译器编译的时候知道每个变量所储存的地址，直接使用地址来读写便是。

嗦嘎，原来如此，不管是否真得如此，但我还是选择相信！我只需要一个理由啊！之前有看过那两本（计算机怎么跑，程序怎么跑）由日本人写的书！所以选择相信！




